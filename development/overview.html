<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Overview &#8212; GGRC 0.10.35-Raspberry (beb3baa) documentation</title>
    
    <link rel="stylesheet" href="../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.10.35-Raspberry (beb3baa)',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="GGRC 0.10.35-Raspberry (beb3baa) documentation" href="../index.html" />
    <link rel="up" title="Development" href="index.html" />
    <link rel="next" title="Adding a new Object" href="adding_new_object.html" />
    <link rel="prev" title="Development" href="index.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="adding_new_object.html" title="Adding a new Object"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Development"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">GGRC 0.10.35-Raspberry (beb3baa) documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Development</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="overview">
<h1>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h1>
<p>This document is a reference for anyone interested in understanding how
GGRC is constructed. The goal for this document is to explain how
everything works in moderate detail with references to source code which
can be used to understand in exact detail how GGRC works.</p>
<div class="section" id="server-side">
<h2>Server Side<a class="headerlink" href="#server-side" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id1">
<h3>Overview<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>The interface to the back-end is a REST API. This API is also referred
to as a “resource layer”.</p>
<p>Requests come into the REST API. These requests pass through various
filters which handle basic concerns such as
authentication/authorization/session management (ggrc.login, RBAC),
parsing request and formatting responses and others (e.g. query
generation).</p>
<p>Besides saving/creating/deleting/updating models the server-side REST API
also includes business logic and validation. The server-side is
stateless. Complex business logic is also duplicated within the client-side
portions of the application to make operations like validating inputs more
responsive.</p>
</div>
<div class="section" id="composing-the-server-side">
<h3>Composing the server-side<a class="headerlink" href="#composing-the-server-side" title="Permalink to this headline">¶</a></h3>
<p>All of the server-side functionality and behaviors are pulled together
in <a class="reference external" href="https://github.com/google/ggrc-core/tree/dev/src/ggrc/app.py">src/ggrc/app.py</a>. This is where all
infrastructure is initialized and loaded.</p>
</div>
<div class="section" id="resource-layer">
<h3>Resource Layer<a class="headerlink" href="#resource-layer" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id2">
<h4>Overview<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h4>
<p>The resource layer provides a uniform, external interface to the data
model. There isn’t much more to it than that.</p>
<p>The code that builds out the API (what endpoints exist and what HTTP
verbs are allowed on each) is in <a class="reference external" href="https://github.com/google/ggrc-core/tree/dev/src/ggrc/services">src/ggrc/services</a>.</p>
<p>See <a class="reference internal" href="../api/index.html#api-docs"><span class="std std-ref">API</span></a> for more details.</p>
</div>
<div class="section" id="general-rest-parameters">
<h4>General REST parameters<a class="headerlink" href="#general-rest-parameters" title="Permalink to this headline">¶</a></h4>
<p>Every REST API request can take the following parameters:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">__stubs_only</span></code> - return only the <code class="docutils literal"><span class="pre">id</span></code>, <code class="docutils literal"><span class="pre">type</span></code>, <code class="docutils literal"><span class="pre">href</span></code> and
<code class="docutils literal"><span class="pre">context_id</span></code> (A context is a Role-Based Access Control context;
every program, audit or workflow has one) fields for each matched
object</li>
<li><code class="docutils literal"><span class="pre">__fields</span></code> - specify field names to return</li>
</ul>
<p>Every REST request (except for search) must pass an
<code class="docutils literal"><span class="pre">'Accept':'application/json'</span></code> header (in order to prevent XSS
attacks), or a 406 error will be returned.</p>
<p><strong>Example</strong> - return the fields <code class="docutils literal"><span class="pre">id</span></code>, <code class="docutils literal"><span class="pre">title</span></code> and <code class="docutils literal"><span class="pre">description</span></code>
for two programs:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>GET /api/programs?id__in=2935,2806&amp;__fields=id,title,description
</pre></div>
</div>
</div>
<div class="section" id="rest-response-result-paging">
<h4>REST Response Result Paging<a class="headerlink" href="#rest-response-result-paging" title="Permalink to this headline">¶</a></h4>
<p>20 records per request are returned by default. This is configurable up
to a max of 100 results per page. &nbsp;See <code class="docutils literal"><span class="pre">apply_paging</span></code> in
<a class="reference external" href="https://github.com/google/ggrc-core/tree/dev/src/ggrc/services/common.py">src/ggrc/services/common.py</a>. Request
parameters:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">__page_only</span></code> - only returns paging information, but not resource
information</li>
<li>page - defaults to 0 if <code class="docutils literal"><span class="pre">__page_only</span></code> was specified, and 1
otherwise TBD</li>
</ul>
<p><strong>Example</strong> - return the first 20 programs:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>GET /api/programs?id__in=1,2,...&amp;__page=1
</pre></div>
</div>
</div>
<div class="section" id="search">
<h4>Search<a class="headerlink" href="#search" title="Permalink to this headline">¶</a></h4>
<p>⚠️ The /search API is being deprecated in favor of <a class="reference internal" href="advanced_query_api.html#advanced-query-api"><span class="std std-ref">Advanced Query API</span></a></p>
<p>The server-side logic that handles search is in <a class="reference external" href="https://github.com/google/ggrc-core/tree/dev/src/ggrc/services/search.py">src/ggrc/services/search.py</a>.</p>
<p>Parameters:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">q</span></code> - the query; mandatory, but can be the empty string</li>
<li><code class="docutils literal"><span class="pre">contact_id</span></code> - assume that id as the initiating user. Not a great
name for it &#8211; it&#8217;s the user to whom items should be related. For
MyWork, this will be the current user, but on another user X&#8217;s
profile page, it&#8217;s user X.</li>
<li><code class="docutils literal"><span class="pre">__permission_type</span></code> - default &#8220;read&#8221; TBD</li>
<li><code class="docutils literal"><span class="pre">__permission_model</span></code> - ? TBD</li>
<li><code class="docutils literal"><span class="pre">group_by_type</span></code> - ? TBD</li>
<li><code class="docutils literal"><span class="pre">counts_only</span></code> - return only the counts of the items found. Used to
show the counts in the LHN tree.</li>
<li><code class="docutils literal"><span class="pre">types</span></code> - restrict search to the specified types, e.g.
types=Program,Audit</li>
<li><code class="docutils literal"><span class="pre">extra_params</span></code> - unsure. When retrieving counts for workflow states
(active, inactive, draft), this parameter is
&#8220;Workflow_All=Workflow,Workflow_Active=Workflow,Workflow_Draft=Workflow,Workflow_Inactive=Workflow&#8221;.
This may be a special case to handle the extra counts in the LHN
Workflows section. TBD.</li>
<li><code class="docutils literal"><span class="pre">extra_columns</span></code> - same as above, this parameter is:
&#8220;Workflow:status=Active;Workflow_Active:status=Active;Workflow_Inactive:status=Inactive;Workflow_Draft:status=Draft&#8221;
TBD</li>
</ul>
</div>
<div class="section" id="routing">
<h4>Routing<a class="headerlink" href="#routing" title="Permalink to this headline">¶</a></h4>
<p>Routes to types of resources (audits, programs, etc.), as well as the
base routes for the REST API (<code class="docutils literal"><span class="pre">/api/</span></code> and <code class="docutils literal"><span class="pre">/search/</span></code>) are determined
with the help of a small amount of metadata specified in <a class="reference external" href="https://github.com/google/ggrc-core/tree/dev/src/ggrc/services/__init__.py">src/ggrc/services/__init__.py</a>.</p>
<p>Routes are specified in other places within the Python code via the
&#64;app.route annotation.</p>
</div>
</div>
<div class="section" id="data-layer">
<h3>Data Layer<a class="headerlink" href="#data-layer" title="Permalink to this headline">¶</a></h3>
<div class="section" id="data-model">
<h4>Data Model<a class="headerlink" href="#data-model" title="Permalink to this headline">¶</a></h4>
<p>The backend data model (written in Python) lives in <code class="docutils literal"><span class="pre">src/&lt;module&gt;/models</span></code>.</p>
<p>The data model classes and fields are mapped to database tables and
columns using SQLAlchemy. These mappings are defined in the model
classes themselves. Constraints used for validation and data integrity
are described within the model classes as well.</p>
</div>
<div class="section" id="internal-vs-external-model">
<h4>Internal vs. External Model<a class="headerlink" href="#internal-vs-external-model" title="Permalink to this headline">¶</a></h4>
<p>An abstraction exists between the actual data model and the external
representation of the data model rendered through the REST interface.
This abstraction is necessary because it decouples the external
structure of a model from the actual internal structure of the model.
This decoupling allows changes to be made to the internal model without
violating the contract provided by the REST API. Without this
abstraction changes made to the internal model could cause consumers of
the REST API to break, and that would be bad.</p>
<p>The &#8220;decoupling&#8221; is two places:</p>
<ol class="arabic simple">
<li>First, the resource-representation is constructed using the Builder
class (<code class="docutils literal"><span class="pre">ggrc.builder.json</span></code>), the behavior of which is currently
defined from the model and the <code class="docutils literal"><span class="pre">_api_attrs</span></code> attributes.</li>
<li>Second, the interaction of resources and the database is defined by
the Resource class (<code class="docutils literal"><span class="pre">ggrc.services.common.Resource</span></code>). The
<code class="docutils literal"><span class="pre">service(...)</span></code> mappings in <code class="docutils literal"><span class="pre">ggrc.services.__init__</span></code> are defining
API endpoints and linking them to Builder classes (autogenerated from
the supplied model).</li>
</ol>
<p>Attributes to be included in the external representation of the model
are declared via the <code class="docutils literal"><span class="pre">_api_attrs</span></code> attribute of a Python model.
Attributes not included in that list will not be included in external
representations of the model.</p>
</div>
<div class="section" id="database-migrations">
<h4>Database Migrations<a class="headerlink" href="#database-migrations" title="Permalink to this headline">¶</a></h4>
<p>Migrations are implemented and executed via
<a class="reference external" href="http://alembic.zzzcomputing.com/en/latest/">alembic</a>, augmented to
support extension modules in ggrc.migrate. &nbsp;(The standard <code class="docutils literal"><span class="pre">alembic</span></code>
command will <em>not</em> do the right thing.)</p>
<p>Migration scripts are written in Python and live in
<code class="docutils literal"><span class="pre">src/&lt;module&gt;/migrations/versions</span></code>.</p>
<p>Migrations are executed by running <code class="docutils literal"><span class="pre">db_migrate</span></code> from the command line.
&nbsp;This effectively runs</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">-</span><span class="n">c</span> <span class="s2">&quot;import ggrc.migrate; ggrc.migrate.upgradeall()&quot;</span>
</pre></div>
</div>
<p>which iterates through existing modules and runs missing migrations for
each.</p>
<p>Migrations can be autogenerated from a fully-migrated environment by
first making changes to in-Python model definitions, and then executing
(e.g.)</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">ggrc</span><span class="o">.</span><span class="n">migrate</span> <span class="n">ggrc_workflows</span> <span class="n">revision</span> <span class="o">--</span><span class="n">autogenerate</span> <span class="o">-</span><span class="n">m</span> <span class="s2">&quot;Add Cycle.is_current&quot;</span>
</pre></div>
</div>
<p>This will create a new migration file with many unwanted changes
(indexes, changes to nullability, etc) due to inconsistencies between
database state and model definition. &nbsp;These should eventually be fixed.
&nbsp;(Indexes should eventually be consistently named, etc.)</p>
</div>
</div>
<div class="section" id="presentation-layer">
<h3>Presentation Layer<a class="headerlink" href="#presentation-layer" title="Permalink to this headline">¶</a></h3>
<div class="section" id="templates">
<h4>Templates<a class="headerlink" href="#templates" title="Permalink to this headline">¶</a></h4>
<p>Templates are HAML files which define the structural HTML which is
basically the scaffolding around which the functionality and features of
GGRC are built. Templates don’t define JavaScript logic, client-side
models, or “how to render an Audit”. Those types of view logic are
defined in <code class="docutils literal"><span class="pre">.js</span></code> and <code class="docutils literal"><span class="pre">.mustache</span></code> files.</p>
</div>
<div class="section" id="views">
<h4>Views<a class="headerlink" href="#views" title="Permalink to this headline">¶</a></h4>
<p>Enough HTML to bootstrap JavaScript. Views are defined in
<code class="docutils literal"><span class="pre">src/&lt;module&gt;/views</span></code>. They are Python methods
which are mapped to routes (relative URLs).</p>
<p>These views serve two functions:</p>
<ol class="arabic simple">
<li>They provide a way to augment the underlying resource paradigm with
addition of non-RESTful application logic (Ex. <code class="docutils literal"><span class="pre">/admin/reindex</span></code>).</li>
<li>They provide entry points into the application from which templates
can be rendered, which bootstraps the JavaScript which constructs the
majority of the actual UI.</li>
</ol>
</div>
<div class="section" id="encoding-and-formatting">
<h4>Encoding and Formatting<a class="headerlink" href="#encoding-and-formatting" title="Permalink to this headline">¶</a></h4>
<p>Responses returned from the server-side are generated by rendering
Python objects into an encoding and format that is understood by the
client-side. The standard format is JSON.</p>
<p>The Python code that marshals/unmarshals models to/from JSON is in <a class="reference external" href="https://github.com/google/ggrc-core/tree/dev/src/ggrc/builder">src/ggrc/builder</a>.</p>
</div>
<div class="section" id="import">
<h4>Import<a class="headerlink" href="#import" title="Permalink to this headline">¶</a></h4>
<p>Data Import is a special case in which requests (as opposed to
responses) have to be parsed in order to build models which can then be
saved to the underlying database. This is basically just the exact
reverse of formatting python objects as JSON, with the caveat that the
import format is CSV instead of JSON.</p>
</div>
<div class="section" id="export">
<h4>Export<a class="headerlink" href="#export" title="Permalink to this headline">¶</a></h4>
<p>Export is similar to default response formatting in the sense that
Python models are rendered in a standard format (usually JSON). But in
the case of export, the format is CSV.</p>
</div>
<div class="section" id="request-interpretation-and-response-construction">
<h4>Request Interpretation and Response Construction<a class="headerlink" href="#request-interpretation-and-response-construction" title="Permalink to this headline">¶</a></h4>
<p>The code that interprets requests (to figure out what action to take on
the server-side) and constructs responses (applying rendering logic to
models) lives in <a class="reference external" href="https://github.com/google/ggrc-core/tree/dev/src/ggrc/services">src/ggrc/services</a>. <a class="reference external" href="https://github.com/google/ggrc-core/tree/dev/src/ggrc/services/common.py">src/ggrc/services/common.py</a>
is particularly important. It implements ModelView &amp; Resource (which extends ModelView).</p>
</div>
</div>
<div class="section" id="infrastructure-and-utilities">
<h3>Infrastructure and Utilities<a class="headerlink" href="#infrastructure-and-utilities" title="Permalink to this headline">¶</a></h3>
<div class="section" id="persistence">
<h4>Persistence<a class="headerlink" href="#persistence" title="Permalink to this headline">¶</a></h4>
<p>CloudSQL MySQL 2nd Gen 5.6 is the underlying database used when running on App Engine.</p>
<p>MySQL 5.6 is used when running locally (for development).</p>
</div>
<div class="section" id="caching">
<h4>Caching<a class="headerlink" href="#caching" title="Permalink to this headline">¶</a></h4>
<p>Memcache is used.</p>
<p>A manifest of the types of objects that should be cached exists in
<a class="reference external" href="https://github.com/google/ggrc-core/tree/dev/src/ggrc/cache/cache.py">src/ggrc/cache/cache.py</a>. Types not listed in this file will not be cached
by Memcache.</p>
<p>All of the logic related to cache management is in <a class="reference external" href="https://github.com/google/ggrc-core/tree/dev/src/ggrc/cache">src/ggrc/cache</a>.</p>
</div>
<div class="section" id="authentication">
<h4>Authentication<a class="headerlink" href="#authentication" title="Permalink to this headline">¶</a></h4>
<p>The Python code that handles authentication is in <a class="reference external" href="https://github.com/google/ggrc-core/tree/dev/src/ggrc/login">src/ggrc/login</a>.
There are currently two handlers, one to enable integration with
Google Accounts and another to enable a developer to log in as a specific
user by modifying a config file or request header.</p>
</div>
<div class="section" id="data-import">
<h4>Data Import<a class="headerlink" href="#data-import" title="Permalink to this headline">¶</a></h4>
<p>Several types of data can be imported into GGRC by uploading CSV files.
The data in those files needs to be converted into python models and
validated before being persisted. The code that handles all of this is
in <a class="reference external" href="https://github.com/google/ggrc-core/tree/dev/src/ggrc/converters">src/ggrc/converters</a>. All of the base
classes which define common handling logic, as well as code specific to
one or more types of model is in that folder.</p>
</div>
<div class="section" id="extensions">
<h4>Extensions<a class="headerlink" href="#extensions" title="Permalink to this headline">¶</a></h4>
<p>Core code which enables the extension mechanism is in <a class="reference external" href="https://github.com/google/ggrc-core/tree/dev/src/ggrc/extensions.py">src/ggrc/extensions.py</a>.</p>
<p>Core code which bootstraps the core GGRC extensions (such as Workflow
and GDrive integration) is in <a class="reference external" href="https://github.com/google/ggrc-core/tree/dev/src/ggrc/ext/__init__.py">src/ggrc/ext/__init__.py</a>.</p>
</div>
<div class="section" id="notifications">
<h4>Notifications<a class="headerlink" href="#notifications" title="Permalink to this headline">¶</a></h4>
<p>Code relevant to sending notifications (e.g. email) is in <a class="reference external" href="https://github.com/google/ggrc-core/tree/dev/src/ggrc/notifications">src/ggrc/notifications</a>.</p>
</div>
<div class="section" id="role-based-access-control-rbac">
<h4>Role-Based Access Control (RBAC)<a class="headerlink" href="#role-based-access-control-rbac" title="Permalink to this headline">¶</a></h4>
<p>RBAC controls the ways in which a user is allowed to interact with GGRC.</p>
<p>Base classes for defining, managing and checking permissions are in <a class="reference external" href="https://github.com/google/ggrc-core/tree/dev/src/ggrc/rbac">src/ggrc/rbac</a>.</p>
</div>
<div class="section" id="cron">
<h4>Cron<a class="headerlink" href="#cron" title="Permalink to this headline">¶</a></h4>
<p>Cron jobs are available through App Engine&#8217;s scheduled tasks mechanism.
This facility is configured via <a class="reference external" href="https://github.com/google/ggrc-core/tree/dev/src/cron.yaml">src/cron.yaml</a>.</p>
</div>
<div class="section" id="ad-hoc-scheduled-tasks-in-task-queue">
<h4>Ad-Hoc Scheduled Tasks in Task Queue<a class="headerlink" href="#ad-hoc-scheduled-tasks-in-task-queue" title="Permalink to this headline">¶</a></h4>
<p>Generating assessments, Rebuilding full-text index, updating revisions</p>
</div>
</div>
<div class="section" id="runtime-configurations">
<h3>Runtime Configurations<a class="headerlink" href="#runtime-configurations" title="Permalink to this headline">¶</a></h3>
<p>GGRC runs in different environments in two dimensions. The first
dimension is App Engine vs. local. The second dimension is
development/testing/production.</p>
<p>Which settings are loaded is determined by the environment variable
<code class="docutils literal"><span class="pre">GGRC_SETTINGS_MODULE</span></code>. This variable is expected to contain a set of
strings separated by spaces. It should be pretty clear as to how these
strings correlate to Python files/modules after looking at the value of
that variable.</p>
<div class="section" id="appengine-runtime-vs-local-runtime">
<h4>Appengine Runtime vs. Local Runtime<a class="headerlink" href="#appengine-runtime-vs-local-runtime" title="Permalink to this headline">¶</a></h4>
<p>GGRC uses MySQL when running locally. There are other configurations
like logging level and authorization which can be configured.</p>
<p>GGRC always uses Google Accounts for authentication when running in App
Engine. This is handled by <a class="reference external" href="https://github.com/google/ggrc-core/tree/dev/src/ggrc/login/appengine.py">src/ggrc/login/appengine.py</a>. When
running locally, however, different authentication logic is substituted
via <a class="reference external" href="https://github.com/google/ggrc-core/tree/dev/src/ggrc/login/noop.py">src/ggrc/login/noop.py</a>. Within
this file a developer can hard-code authentication email address and
name. There is also logic to allow a developer to pass their email
address (allowing them to log in as a specific user) in through a
request header (<code class="docutils literal"><span class="pre">X-ggrc-user</span></code>) which can be manipulated with one of a
few Chrome browser plugins. This makes it efficient for a developer to
switch among user accounts to test functionality.</p>
<p>Please take a minute to look at <a class="reference external" href="https://github.com/google/ggrc-core/tree/dev/src/ggrc/settings/app_engine.py">src/ggrc/settings/app_engine.py</a> and
<a class="reference external" href="https://github.com/google/ggrc-core/tree/dev/src/ggrc/settings/default.py">src/ggrc/settings/default.py</a> for more information on settings that
can be configured for running in either App Engine or local environments.</p>
</div>
<div class="section" id="development-testing-production-runtime">
<h4>Development/Testing/Production Runtime<a class="headerlink" href="#development-testing-production-runtime" title="Permalink to this headline">¶</a></h4>
<p>This dimension of runtime configuration allows setting of database
credentials, query and application logging and other configurations.</p>
<p>Settings typical for a development environment are in
<a class="reference external" href="https://github.com/google/ggrc-core/tree/dev/src/ggrc/settings/development.py">src/ggrc/settings/development.py</a>.</p>
<p>Settings typical for a testing environment are in
<a class="reference external" href="https://github.com/google/ggrc-core/tree/dev/src/ggrc/settings/testing.py">src/ggrc/settings/testing.py</a>.</p>
</div>
</div>
</div>
<div class="section" id="client-side">
<h2>Client Side<a class="headerlink" href="#client-side" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id3">
<h3>Overview<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<p>The client-side of GGRC is initially constructed from templates and/or
views defined and rendered on the server. The templates and views
provide a scaffolding for the UI. Rendering those elements invokes
JavaScript code which bootstraps the majority of the client-side of GGRC
which is constructed from CanJS Controls, Components and Mustache templates.</p>
<p>Once the Controls are rendered, they take control of generating the
remainder of the UI and attaching all relevant logic and user
interaction handlers.</p>
<p>There are two main objects that are useful in managing the data model:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">GGRC</span></code></li>
<li><code class="docutils literal"><span class="pre">CMS</span></code></li>
</ul>
<p>For example, <code class="docutils literal"><span class="pre">GGRC.page_instance()</span></code> returns the current page instance,
and <code class="docutils literal"><span class="pre">GGRC.page_object</span></code> is the object rendered by the current page
(e.g. a Program), as it was received from the server (mapped objects are
stubs).</p>
<p><code class="docutils literal"><span class="pre">CMS.Models.&lt;MODEL&gt;.cache</span></code> stores the loaded objects. For example,
<code class="docutils literal"><span class="pre">CMS.Models.Program.cache</span></code> will have an array of all the loaded
programs.</p>
</div>
<div class="section" id="client-side-file-manifests">
<h3>Client-side File Manifests<a class="headerlink" href="#client-side-file-manifests" title="Permalink to this headline">¶</a></h3>
<p>Mustache templates need to be referenced
from a manifest file in order for it to be usable in constructing the
UI.</p>
<p>These manifest files live in <code class="docutils literal"><span class="pre">src/&lt;module&gt;/assets/assets.yaml</span></code>.</p>
<p>Javascript resources are bundled together using webpack.</p>
</div>
<div class="section" id="page-structure">
<h3>Page Structure<a class="headerlink" href="#page-structure" title="Permalink to this headline">¶</a></h3>
<p><strong>TODO</strong>: Show and talk about diagram with Title, LHN, Dashboard,
Dashboard Widget, Info Widget, TreeView &amp; TreeNode.</p>
<div class="figure" id="id5">
<img alt="Page structure" src="../_images/page_structure.png" />
<p class="caption"><span class="caption-text">Page structure</span></p>
</div>
<div class="section" id="view-logic">
<h4>View Logic<a class="headerlink" href="#view-logic" title="Permalink to this headline">¶</a></h4>
<p>View logic is defined within the control (as functions on the control
itself).</p>
</div>
</div>
<div class="section" id="widgets-tabs">
<h3>Widgets (tabs)<a class="headerlink" href="#widgets-tabs" title="Permalink to this headline">¶</a></h3>
<p>Which widgets (or tabs) are shown on the object page is defined in
<code class="docutils literal"><span class="pre">business_objects.js</span></code>.
This is where we state which controller should be used for each tab
(InfoWidget/TreeView/ListView). TreeViews are used almost everywhere,
except on the Admin Dashboard, where we are using ListViews. ListViews
have pagination.</p>
<p>Almost every TreeView controller instance has a <code class="docutils literal"><span class="pre">parent_instance</span></code>
variable that can be used to access the parent. You can&#8217;t get the parent
of an object without a TreeView, because an object can have multiple
parents (think of it as a graph). Our TreeViews are trees inside this
graph so that&#8217;s why we can have parent instances in this context.</p>
<p>Filtering a TreeView is done in the TreeFilter, which simply hides the
elements from the DOM.</p>
</div>
<div class="section" id="quickformcontroller">
<h3>QuickFormController<a class="headerlink" href="#quickformcontroller" title="Permalink to this headline">¶</a></h3>
<p>This controller derives from the Modals controller in that it takes form
input, converts it into properties on model instances, and saves the
changes back to the server. A primary difference in QuickForm is that
any update to the instance triggered by QuickForm results in an
immediate save(). Also, QuickForm was created with the expectation that
the instance already exists on the server; attempts to work with new
model instances before first save may result in unexpected behavior.</p>
<ul class="simple">
<li>How do controllers interact with controls?</li>
<li>How do controllers interact with the backend?</li>
</ul>
</div>
<div class="section" id="model">
<h3>Model<a class="headerlink" href="#model" title="Permalink to this headline">¶</a></h3>
<p>View models (defined in JavaScript) are in
<code class="docutils literal"><span class="pre">src/&lt;module&gt;/assets/javascripts/models/</span></code></p>
<p>The models define:</p>
<ul class="simple">
<li>how a type of model relates to other types</li>
<li>behaviors relevant to the model<ul>
<li>validation rules</li>
<li>event listeners</li>
<li>default values</li>
<li>default view templates</li>
<li>initialization logic</li>
</ul>
</li>
<li>metadata that allows the model to integrate with frameworks and other
conventions</li>
</ul>
<div class="section" id="stubs-vs-full-form-models">
<h4>Stubs vs. Full-form Models<a class="headerlink" href="#stubs-vs-full-form-models" title="Permalink to this headline">¶</a></h4>
<p>All models have a stub and a full form. All collection attributes of a
full form object are stubs.</p>
<p>A stub is a lightweight representation of a full-form model. A stub has
references to complex attributes such as collections or other complex
models. But those references have to be “traded in” for either stubs or
full-form objects in order to walk through the data model. This approach
is somewhat analogous to “lazy-loading”.</p>
<p>In contrast, all of the models referenced by a full-form model are not
just placeholders, but are true model instances themselves. This
approach is more analogous to “eager-loading”.</p>
<p>A stub can be converted into a full-form instance by calling <code class="docutils literal"><span class="pre">reify()</span></code>
on the stub. See also <code class="docutils literal"><span class="pre">builder.json</span></code>.</p>
</div>
<div class="section" id="lifecycle-of-a-model">
<h4>Lifecycle of a Model<a class="headerlink" href="#lifecycle-of-a-model" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Primary Operations</li>
<li>Saving</li>
</ul>
<p>Saving is either done as an update or create operation. See Updating and
Creating below. * Updating</p>
<p>Updating happens when an instance is known to exist on the server (the
determinant is whether the id property is set on the instance) and
<code class="docutils literal"><span class="pre">save()</span></code> is called on the instance. The update is executed with a PUT
request to the object endpoint. * Creating</p>
<p>Creating happens when an instance is known not to exist on the server
(id property is not set) and <code class="docutils literal"><span class="pre">save()</span></code> is called on the instance. The
create is executed with a POST request to the collection endpoint. *
Deleting Deleting can only happen on an instance which is known to exist
on the server (see Updating above), when <code class="docutils literal"><span class="pre">destroy()</span></code> is called on a
model instance. The delete is executed with a DELETE request to the
object endpoint. Deletion may execute immediately on the server, in
which case the former data of the deleted object is returned, or
deletion may be offloaded to a background task, in which case the
returned content from the operation will reference the background_task
object. On the client side, the deferred returned from <code class="docutils literal"><span class="pre">destroy()</span></code>
will not resolve until the background task completes.</p>
<ul class="simple">
<li>Non-lifecycle Model Interactions</li>
<li>_transient property</li>
</ul>
<p>This property is set on instances during modal operation. <em>transient is
meant to hold data that is not sent to the server and does not need to
be kept after the modal completes or is canceled. This is useful for
intermediary values for validation, or calculated default values for a
property. * _pending</em>joins() / &#8220;deferred bindings&#8221;</p>
<p>Model instances can be joined to other objects as part of their regular
update cycles. After an update completes successfully, any deferred
binding operations contained in <code class="docutils literal"><span class="pre">&lt;instance&gt;._pending_joins</span></code> are
resolved by adding or removing join objects. These deferred bindings are
usually created by using <code class="docutils literal"><span class="pre">&lt;instance&gt;.mark_for_addition()</span></code> and
<code class="docutils literal"><span class="pre">&lt;instance&gt;.mark_for_deletion()</span></code> * other modal-based ops</p>
<p>The modal includes a connector widget that allows pending join object
creation and destruction. Since the connector widget automates the
deferred bindings for an instance in deferred mode, no action is taken
until the modal is saved.</p>
<p>Are they cached?</p>
<ul class="simple">
<li>Server-side:<ul>
<li>Memcache<ul>
<li>Added to memcache <em>only</em> on “collection GET” requests, and
expired on any “object PUT” or “object DELETE” requests.</li>
<li>[The current locking mechanism (to avoid un-ordered operations
from simultaneous requests) is broken and subject to race
conditions. In its place, a more standard form of distributed
locking should be used, paying attention to the constraints and
guarantees made by App Engine&#8217;s memcache service.]</li>
</ul>
</li>
</ul>
</li>
<li>Client-side:<ul>
<li>can.Model.Cacheable<ul>
<li>Once a model is retrieved to the browser, it is stored in
<code class="docutils literal"><span class="pre">CMS.Models.&lt;model_name&gt;.cache[&lt;id&gt;]</span></code>. &nbsp;Once present, it is
only requested again via the <code class="docutils literal"><span class="pre">&lt;instance&gt;.refresh()</span></code> method.</li>
<li>A model can be conditionally pulled from the server (if it only
exists on the client in stub form) by enqueueing it into a
RefreshQueue, and then subsequently triggering the
RefreshQueue. If an enqueued model has already been synched
(i.e. if the selfLink property exists on the instance), it will
not be re-fetched by the RefreshQueue.</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>How/when are they validated?</p>
<ul class="simple">
<li>Server-side:<ul>
<li>In-database constraints</li>
<li>SQLAlchemy validations (using <code class="docutils literal"><span class="pre">&#64;validates</span></code>)</li>
</ul>
</li>
<li>Client-side:<ul>
<li>Defined in class <code class="docutils literal"><span class="pre">init()</span></code> method on Model classes, and uses Can
Validations (<a class="reference external" href="http://canjs.com/docs/can.Map.validations.html">http://canjs.com/docs/can.Map.validations.html</a>)</li>
<li>Includes a custom <code class="docutils literal"><span class="pre">validateNonBlank()</span></code> validation function that
trims strings before checking for empty strings.</li>
</ul>
</li>
</ul>
</div>
</div>
<div class="section" id="view">
<h3>View<a class="headerlink" href="#view" title="Permalink to this headline">¶</a></h3>
<p>View templates are implemented all in JavaScript with the help of
Mustache.</p>
<div class="section" id="standard-view-templates">
<h4>Standard view templates<a class="headerlink" href="#standard-view-templates" title="Permalink to this headline">¶</a></h4>
<p>Several standard view fragments are defined for each type of entity
within GGRC. Additional fragments can be created and utilized as needed.
But these templates are the main templates from which the majority of
the UI is created.</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">tree.mustache</span></code> - Defines the content of the trees for specified
object types. This template reflects Tier 1 and Tier 2 information
(Tier 2 being a more detailed set of information relevant to an
object). &nbsp;Specified as the <code class="docutils literal"><span class="pre">show_view</span></code> option in each TreeView.</li>
<li><code class="docutils literal"><span class="pre">tree_footer.mustache</span></code> - If present, defines the content of the
last row of a given tree. &nbsp;Usually contains a “Add Object” or “+
Object” link which invokes a mapping or creation modal. &nbsp;Specified as
the <code class="docutils literal"><span class="pre">footer_view</span></code> option in each TreeView.</li>
<li><code class="docutils literal"><span class="pre">info.mustache</span></code> - Defines the “Info” widget on each object’s page.
&nbsp;Defined per-widget in GGRC.Controllers.InfoWidget as the
<code class="docutils literal"><span class="pre">widget_view</span></code> option, and specified using <code class="docutils literal"><span class="pre">GGRC.WidgetList</span></code>
definitions.</li>
<li><code class="docutils literal"><span class="pre">extended_info.mustache</span></code> - Defines the content of an object’s
tooltip/popover in the LHN lists. &nbsp;Specified as the <code class="docutils literal"><span class="pre">tooltip_view</span></code>
parameter when rendering
<a class="reference external" href="https://github.com/google/ggrc-core/tree/dev/src/ggrc/assets/mustache/dashboard/lhn.mustache">src/ggrc/assets/mustache/dashboard/lhn.mustache</a>.</li>
<li><code class="docutils literal"><span class="pre">modal_content.mustache</span></code> - Defines the view for modal “create” or
“edit” form functionality. &nbsp;For most objects, this path is
automatically generated using the <code class="docutils literal"><span class="pre">data-template</span></code> or
<code class="docutils literal"><span class="pre">data-object-plural</span></code> attributes of the invoking element (see
<code class="docutils literal"><span class="pre">bootstrap/modal-ajax.js</span></code>.</li>
</ul>
</div>
<div class="section" id="where-to-find-view-templates">
<h4>Where to find view templates<a class="headerlink" href="#where-to-find-view-templates" title="Permalink to this headline">¶</a></h4>
<p>The view files are in the following folder within a module
<code class="docutils literal"><span class="pre">src/&lt;module&gt;/assets/mustache/</span></code>.</p>
<p>For example, the <code class="docutils literal"><span class="pre">ggrc_workflow</span></code> views are in the following folder
<a class="reference external" href="https://github.com/google/ggrc-core/tree/dev/src/ggrc_workflows/assets/mustache/">src/ggrc_workflows/assets/mustache/</a></p>
</div>
<div class="section" id="view-helpers">
<h4>View Helpers<a class="headerlink" href="#view-helpers" title="Permalink to this headline">¶</a></h4>
<p>View helpers are defined using the Mustache <a class="reference external" href="http://canjs.com/docs/can.mustache.Helpers.html">helper mechanism provided
by CanJS</a>. &nbsp;Core
helpers are specified in
<a class="reference external" href="https://github.com/google/ggrc-core/tree/dev/src/ggrc/assets/javascripts/mustache_helpers.js">src/ggrc/assets/javascripts/mustache_helpers.js</a>,
and extension helpers should be specified in a file named similar to
<code class="docutils literal"><span class="pre">src/&lt;module_name&gt;/assets/javascripts/&lt;class_name&gt;_mustache_helpers.js</span></code>.</p>
</div>
</div>
<div class="section" id="id4">
<h3>Extensions<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<p>An extension is a bundle of code and assets packaged into a folder
hierarchy similar to ggrc-core. Extensions have at minimum a startup
script at &lt;extension-folder&gt;/__init__.py and a settings file in
&lt;extension-folder&gt;/settings</p>
<p>The extensions which are used in any GGRC instance are determined by the
GGRC_SETTINGS_MODULE shell variable. To add an extension to a GGRC
deployment, append a space separator and the Python path to the settings
file (e.g. &#8221; ggrc_some_extension.settings.development&#8221;) to this shell
variable, and restart or redeploy the GGRC server.</p>
<p>The minimum that the extension settings file must contain is
<code class="docutils literal"><span class="pre">EXTENSIONS</span> <span class="pre">=</span> <span class="pre">['&lt;name_of_extension&gt;']</span></code>. Additionally, global settings
can be provided; any variable set at the top level in this file will be
added to the <code class="docutils literal"><span class="pre">ggrc.settings</span></code> object and later accessible through
<code class="docutils literal"><span class="pre">from</span> <span class="pre">ggrc</span> <span class="pre">import</span> <span class="pre">settings</span></code>. Setting <code class="docutils literal"><span class="pre">exports</span> <span class="pre">=</span></code> to an array of key
names in the extension settings file will make those keys and their
values available to the client side through the <code class="docutils literal"><span class="pre">GGRC.config</span></code> object.</p>
<p>The minimum that __init__.py must contain is:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">Blueprint</span>

<span class="n">blueprint</span> <span class="o">=</span> <span class="n">Blueprint</span><span class="p">(</span>
    <span class="s1">&#39;&lt;name_of_extension&gt;&#39;</span><span class="p">,</span>
    <span class="vm">__name__</span><span class="p">,</span>
    <span class="n">template_folder</span><span class="o">=</span><span class="s1">&#39;templates&#39;</span><span class="p">,</span>
    <span class="n">static_folder</span><span class="o">=</span><span class="s1">&#39;static&#39;</span><span class="p">,</span>
    <span class="n">static_url_path</span><span class="o">=</span><span class="s1">&#39;/static/&lt;name_of_extension&gt;&#39;</span><span class="p">,</span>
    <span class="p">)</span>
</pre></div>
</div>
<p>This will set up an extension to be recognized by Flask.</p>
<p>Asset hierarchies in extensions should follow the ggrc-core model:
assets.yaml should define the bundles for dashboard-js,
dashboard-templates, and dashboard-js-specs; The folder naming
convention for these bundles (<code class="docutils literal"><span class="pre">assets/javascripts</span></code>,
<code class="docutils literal"><span class="pre">assets/mustache</span></code>, and <code class="docutils literal"><span class="pre">assets/js_specs</span></code>, respectively) should be
followed for each extension. An important caveat is that the assets
bundler can only bundle one asset with a given path over all base
folders, so you should avoid re-using paths known to exist in ggrc-core
or other extensions (e.g. &#8220;mustache_helper.js&#8221; and &#8220;models/mixins.js&#8221;
already exist in ggrc-core, so don&#8217;t name your files the same as these).</p>
<p>DB migrations should be set up in <code class="docutils literal"><span class="pre">migrations/versions</span></code> as in
ggrc-core. Once the extension is created and the settings path added to
GGRC_SETTINGS_MODULE, db_migrate should pick up any migrations
automatically. To completely undo the migrations from an extension (in
order to remove it without possible database breakage), use the command
<code class="docutils literal"><span class="pre">db_downgrade</span> <span class="pre">&lt;name_of_extension&gt;</span> <span class="pre">-1</span></code></p>
<div class="section" id="extension-contributions">
<h4>Extension contributions<a class="headerlink" href="#extension-contributions" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Models</li>
</ul>
<p>Define models in your <code class="docutils literal"><span class="pre">&lt;extension_name&gt;/models/</span></code> folder, and use the
same patterns for implementing them as ggrc-core does (derive from
ggrc.db.Model, use provided mixins, make association proxy tables and
models, etc.). Be sure to import all files from models as part of the
extension&#8217;s __init__.py</p>
<ul class="simple">
<li>Services</li>
</ul>
<p>Services provide the CRUD object endpoints over REST to allow instances
of your extension models. ggrc-core provides a contributions mechanism
for defining more services from your extension at startup time. The
services contribution is done as such:</p>
<p>```python from . import models from ggrc.services.registry import
service</p>
<p>def contributed_services(): return [ service(m.<strong>table</strong>.name, m) for
m in models.<strong>dict</strong>.values() if isinstance(m, type) and issubclass(m,
db.Model) ] ```</p>
<ul class="simple">
<li>Views</li>
<li>Any special templates should be placed under
&lt;extension_module_name&gt;/templates/ and called as normal.</li>
<li>To set up an object page for one of the contributed model classes,
declare a function similar to this (this function will work as long
as your module hierarchy is flat with all models at the first level
and you want all of your objects to have pages):</li>
</ul>
<p>```python from ggrc.views.registry import object_view from . import
models from ggrc import db</p>
<p>def contributed_object_views(): return [ object_view(m) for m in
models.<strong>dict</strong>.values() if isinstance(m, type) and issubclass(m,
db.Model) ] ```</p>
<ul class="simple">
<li>Roles</li>
<li>ROLE_CONTRIBUTIONS: at module level, subclass <code class="docutils literal"><span class="pre">RoleContributions</span></code>,
overriding <code class="docutils literal"><span class="pre">contributions</span></code>, and set this property to an instance of
the subclass.</li>
<li>ROLE_DECLARATIONS: at module level, subclass <code class="docutils literal"><span class="pre">RoleDeclarations</span></code>,
overriding <code class="docutils literal"><span class="pre">roles()</span></code>, and set this property to an instance of the
subclass.</li>
<li>ROLE_IMPLICATIONS: at module level, subclass
<code class="docutils literal"><span class="pre">DeclarativeRoleImplications</span></code>, overriding <code class="docutils literal"><span class="pre">implications</span></code>, and set
this property to an instance of the subclass.</li>
</ul>
</div>
</div>
<div class="section" id="modals">
<h3>Modals<a class="headerlink" href="#modals" title="Permalink to this headline">¶</a></h3>
<p>The core logic and functionality related to modals is defined in the
following files:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">ggrc/assets/javascripts/bootstrap/modal-ajax.js</span></code></li>
<li><code class="docutils literal"><span class="pre">ggrc/assets/javascripts/bootstrap/modal-form.js</span></code></li>
<li><code class="docutils literal"><span class="pre">ggrc/assets/javascripts/controllers/modals_controller.js</span></code></li>
</ul>
<p>The view for a modal is defined in
<code class="docutils literal"><span class="pre">/src/&lt;module&gt;/assets/mustache/&lt;class_name&gt;/modal_content.mustache</span></code>.</p>
<p>More about modals in <a class="reference external" href="modals.md">modals.md</a>.</p>
</div>
<div class="section" id="events">
<h3>Events<a class="headerlink" href="#events" title="Permalink to this headline">¶</a></h3>
<p>Client-side event firing/handling is handled through CanJS, which is
primarily based on jQuery event handling.</p>
</div>
<div class="section" id="program-flow">
<h3>Program Flow<a class="headerlink" href="#program-flow" title="Permalink to this headline">¶</a></h3>
<p>Most client-side logic is implemented in Controls. Much of this logic is
implemented using asynchronous callbacks via
<a class="reference external" href="http://canjs.com/docs/can.Deferred.html">can.Deferred</a>.</p>
</div>
<div class="section" id="error-handling">
<h3>Error Handling<a class="headerlink" href="#error-handling" title="Permalink to this headline">¶</a></h3>
<p>Most errors are reported to the system with a <code class="docutils literal"><span class="pre">window.onerror</span></code> handler
that generates flash messages at the top of the page and reports the
exception back to Tracker. For maximum coverage, the script that defines
this handler is inlined into base.haml.</p>
<p>AJAX failures that happen while a modal is active are reported back to a
flash handler at the modal level (so that the flash messages are not
covered by modals or overlays).</p>
<p>Because the error handler at the window level handles most of our needs,
try/catch blocks are rare in GGRC. However, it is worth noting that
errors in Deferred callbacks may not fire the onerror handler, <em>and</em>
&#8220;break the chain&#8221; inasmuch as the state of the deferred never changes
from &#8220;pending&#8221; after that, and other deferreds waiting for the result of
that deferred will never run. This is a failure of the jQuery Deferred
object to sensibly handle uncaught errors (they should reject the
deferred instead). In the case where it&#8217;s possible that a callback will
throw an error, it is recommended to wrap the content of the callback in
<code class="docutils literal"><span class="pre">try/catch</span></code> and return a rejected deferred when an error happens.</p>
</div>
<div class="section" id="problem-areas">
<h3>Problem Areas<a class="headerlink" href="#problem-areas" title="Permalink to this headline">¶</a></h3>
<p><strong>TODO</strong></p>
</div>
</div>
<div class="section" id="features">
<h2>Features<a class="headerlink" href="#features" title="Permalink to this headline">¶</a></h2>
<div class="section" id="mappings">
<h3>Mappings<a class="headerlink" href="#mappings" title="Permalink to this headline">¶</a></h3>
<p>Mappings are best thought of as <strong>links</strong>. (“Mapping”
<a class="reference external" href="http://www.merriam-webster.com/dictionary/mapping">often means</a> a 1-to-1
correspondence, and for historical reasons is the term adopted by GGRC
users; but in actuality; we have links between objects - e.g. a
Directive is <strong>linked</strong> to a Section, or a Programs <strong>references</strong> zero
or more Controls.) “Mappings” are a way to relate any model instance to
another model instance in a way that is flexible, and doesn&#8217;t require
modifying the relational structure in the underlying data store used for
persistence (database). They&#8217;re essentially just an abstraction over our
database, so that you don&#8217;t have to care about which tables the
relationships are stored in.</p>
<p>Mappings essentially turn the entire system into a
<a class="reference external" href="https://github.com/tinkerpop/gremlin/wiki/Defining-a-Property-Graph">property graph</a>.</p>
<p>Mappings are defined in <a class="reference external" href="https://github.com/google/ggrc-core/tree/dev/src/ggrc/assets/javascripts/models/mappings-ggrc.js">src/ggrc/assets/javascripts/models/mappings-ggrc.js</a>.</p>
<p>We don&#8217;t have a function that gets all the objects mapped to a given
object. You can get the mappings of an instance by calling
<code class="docutils literal"><span class="pre">instance.get_mappings('_mapping_')</span></code> if the mappings are already
loaded, or by calling
<code class="docutils literal"><span class="pre">instance.get_binding('_mapping_').refresh_list()</span></code> if they are not.</p>
<div class="section" id="types-of-mappings">
<h4>Types of Mappings<a class="headerlink" href="#types-of-mappings" title="Permalink to this headline">¶</a></h4>
<p>There are 8 types of mappings. The types of mappings are defined with
Mappers. Mappers are defined in <a class="reference external" href="https://github.com/google/ggrc-core/tree/dev/src/ggrc/assets/javascripts/models/mappers.js">src/ggrc/assets/javascripts/models/mappers.js</a></p>
<p>Each type of mapping is defined below:</p>
<ul class="simple">
<li><strong>Proxy</strong> <a class="reference external" href="https://github.com/google/ggrc-core/tree/dev/src/ggrc/assets/javascripts/models/mappers/proxy-list-loader.js">src/ggrc/assets/javascripts/models/mappers/proxy-list-loader.js</a>:
A proxy mapping is a relationship where one model
references another through another “join” or “proxy” model. &nbsp;E.g.,
Programs reference Controls via the ProgramControl join/proxy model.
&nbsp;The Proxy mapping specifies the attributes and models involved in
the relationship, e.g.:</li>
<li><strong>Direct</strong> <a class="reference external" href="https://github.com/google/ggrc-core/tree/dev/src/ggrc/assets/javascripts/models/mappers/direct-list-loader.js">src/ggrc/assets/javascripts/models/mappers/direct-list-loader.js</a>:
A direct mapping is a relationship where one model
directly references another model. &nbsp;E.g., Sections contain a
<code class="docutils literal"><span class="pre">directive</span></code> attribute, so Section has a Direct mapping to
Directive.</li>
<li><strong>Indirect</strong> <a class="reference external" href="https://github.com/google/ggrc-core/tree/dev/src/ggrc/assets/javascripts/models/mappers/indirect-list-loader.js">src/ggrc/assets/javascripts/models/mappers/indirect-list-loader.js</a>:
An indirect mapping is the reverse of <code class="docutils literal"><span class="pre">Direct</span></code>, but
the implementation is inconsistent with the rest of the mappers.</li>
<li><strong>Search</strong> <a class="reference external" href="https://github.com/google/ggrc-core/tree/dev/src/ggrc/assets/javascripts/models/mappers/search-list-loader.js">src/ggrc/assets/javascripts/models/mappers/search-list-loader.js</a>:
A search mapping is a relationship where results are
produced by a function returning a deferred. This mapping is f
foremost used by the Advanced Search feature and for getting owned
objects for a Person, but other uses are also possible. Note that the
search function is run at attach time and also when a new object of
any type is created, so it is recommended to use this mapper
sparingly in the system if it makes a number of large AJAX calls.</li>
<li><strong>Multi</strong> <a class="reference external" href="https://github.com/google/ggrc-core/tree/dev/src/ggrc/assets/javascripts/models/mappers/multi-list-loader.js">src/ggrc/assets/javascripts/models/mappers/multi-list-loader.js</a>:
Constructs a mapping which is the union of zero or more
other mappings. &nbsp;Specifically, the set of <code class="docutils literal"><span class="pre">result.instance</span></code> values
is the union of <code class="docutils literal"><span class="pre">result.instance</span></code> from the contributing mappings.</li>
<li><strong>TypeFilter</strong> <a class="reference external" href="https://github.com/google/ggrc-core/tree/dev/src/ggrc/assets/javascripts/models/mappers/type-filtered-list-loader.js">src/ggrc/assets/javascripts/models/mappers/type-filtered-list-loader.js</a>:
A TypeFiltered mapping takes the result of another
mapping and returns only the results which are instances of a
specified type. This is useful for filtering polymorphic proxies.</li>
<li><strong>CustomFilter</strong> <a class="reference external" href="https://github.com/google/ggrc-core/tree/dev/src/ggrc/assets/javascripts/models/mappers/custom-filtered-list-loader.js">src/ggrc/assets/javascripts/models/mappers/custom-filtered-list-loader.js</a>:
A custom filtered mapping runs a filter function on
every result coming from a source mapping and returns all results
where the function returns either a truthy value or a deferred that
resolves to a truthy value. The filter function is re-run whenever an
instance in the source mapping changes, and adds and removes a
mapping to that instance accordingly.</li>
<li><strong>Cross</strong> <a class="reference external" href="https://github.com/google/ggrc-core/tree/dev/src/ggrc/assets/javascripts/models/mappers/cross-list-loader.js">src/ggrc/assets/javascripts/models/mappers/cross-list-loader.js</a>:
Similar to Proxy mapping, but joins across other mappings.
For example, the result of <code class="docutils literal"><span class="pre">m</span> <span class="pre">=</span> <span class="pre">Cross(&quot;a&quot;,</span> <span class="pre">&quot;b&quot;)</span></code> would be the
union of the “b” mappings for every instance in the root object’s “a”
result set.</li>
</ul>
</div>
</div>
</div>
<div class="section" id="testing">
<h2>Testing<a class="headerlink" href="#testing" title="Permalink to this headline">¶</a></h2>
<p>GGRC testing consists of 4 components:</p>
<div class="section" id="manual-tests">
<h3>Manual tests<a class="headerlink" href="#manual-tests" title="Permalink to this headline">¶</a></h3>
<p>Several day&#8217;s worth of tests defined in spreadsheets and executed
primarily by Kostya. &nbsp;These are the primary source of regression stories
and bug-finding.</p>
</div>
<div class="section" id="automated-browser-tests">
<h3>Automated Browser Tests<a class="headerlink" href="#automated-browser-tests" title="Permalink to this headline">¶</a></h3>
<p>Implemented using WebDriver for Python and executed either locally or on
the CI server.</p>
</div>
<div class="section" id="python-unit-tests">
<h3>Python Unit Tests<a class="headerlink" href="#python-unit-tests" title="Permalink to this headline">¶</a></h3>
<p>These are currently defined in <a class="reference external" href="https://github.com/google/ggrc-core/tree/dev/src/ggrc/tests">src/ggrc/tests</a>,
but as of 2014/07/07 are in poor state due to non-upkeep. &nbsp;Mostly, these
test import/export.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Overview</a><ul>
<li><a class="reference internal" href="#server-side">Server Side</a><ul>
<li><a class="reference internal" href="#id1">Overview</a></li>
<li><a class="reference internal" href="#composing-the-server-side">Composing the server-side</a></li>
<li><a class="reference internal" href="#resource-layer">Resource Layer</a><ul>
<li><a class="reference internal" href="#id2">Overview</a></li>
<li><a class="reference internal" href="#general-rest-parameters">General REST parameters</a></li>
<li><a class="reference internal" href="#rest-response-result-paging">REST Response Result Paging</a></li>
<li><a class="reference internal" href="#search">Search</a></li>
<li><a class="reference internal" href="#routing">Routing</a></li>
</ul>
</li>
<li><a class="reference internal" href="#data-layer">Data Layer</a><ul>
<li><a class="reference internal" href="#data-model">Data Model</a></li>
<li><a class="reference internal" href="#internal-vs-external-model">Internal vs. External Model</a></li>
<li><a class="reference internal" href="#database-migrations">Database Migrations</a></li>
</ul>
</li>
<li><a class="reference internal" href="#presentation-layer">Presentation Layer</a><ul>
<li><a class="reference internal" href="#templates">Templates</a></li>
<li><a class="reference internal" href="#views">Views</a></li>
<li><a class="reference internal" href="#encoding-and-formatting">Encoding and Formatting</a></li>
<li><a class="reference internal" href="#import">Import</a></li>
<li><a class="reference internal" href="#export">Export</a></li>
<li><a class="reference internal" href="#request-interpretation-and-response-construction">Request Interpretation and Response Construction</a></li>
</ul>
</li>
<li><a class="reference internal" href="#infrastructure-and-utilities">Infrastructure and Utilities</a><ul>
<li><a class="reference internal" href="#persistence">Persistence</a></li>
<li><a class="reference internal" href="#caching">Caching</a></li>
<li><a class="reference internal" href="#authentication">Authentication</a></li>
<li><a class="reference internal" href="#data-import">Data Import</a></li>
<li><a class="reference internal" href="#extensions">Extensions</a></li>
<li><a class="reference internal" href="#notifications">Notifications</a></li>
<li><a class="reference internal" href="#role-based-access-control-rbac">Role-Based Access Control (RBAC)</a></li>
<li><a class="reference internal" href="#cron">Cron</a></li>
<li><a class="reference internal" href="#ad-hoc-scheduled-tasks-in-task-queue">Ad-Hoc Scheduled Tasks in Task Queue</a></li>
</ul>
</li>
<li><a class="reference internal" href="#runtime-configurations">Runtime Configurations</a><ul>
<li><a class="reference internal" href="#appengine-runtime-vs-local-runtime">Appengine Runtime vs. Local Runtime</a></li>
<li><a class="reference internal" href="#development-testing-production-runtime">Development/Testing/Production Runtime</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#client-side">Client Side</a><ul>
<li><a class="reference internal" href="#id3">Overview</a></li>
<li><a class="reference internal" href="#client-side-file-manifests">Client-side File Manifests</a></li>
<li><a class="reference internal" href="#page-structure">Page Structure</a><ul>
<li><a class="reference internal" href="#view-logic">View Logic</a></li>
</ul>
</li>
<li><a class="reference internal" href="#widgets-tabs">Widgets (tabs)</a></li>
<li><a class="reference internal" href="#quickformcontroller">QuickFormController</a></li>
<li><a class="reference internal" href="#model">Model</a><ul>
<li><a class="reference internal" href="#stubs-vs-full-form-models">Stubs vs. Full-form Models</a></li>
<li><a class="reference internal" href="#lifecycle-of-a-model">Lifecycle of a Model</a></li>
</ul>
</li>
<li><a class="reference internal" href="#view">View</a><ul>
<li><a class="reference internal" href="#standard-view-templates">Standard view templates</a></li>
<li><a class="reference internal" href="#where-to-find-view-templates">Where to find view templates</a></li>
<li><a class="reference internal" href="#view-helpers">View Helpers</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id4">Extensions</a><ul>
<li><a class="reference internal" href="#extension-contributions">Extension contributions</a></li>
</ul>
</li>
<li><a class="reference internal" href="#modals">Modals</a></li>
<li><a class="reference internal" href="#events">Events</a></li>
<li><a class="reference internal" href="#program-flow">Program Flow</a></li>
<li><a class="reference internal" href="#error-handling">Error Handling</a></li>
<li><a class="reference internal" href="#problem-areas">Problem Areas</a></li>
</ul>
</li>
<li><a class="reference internal" href="#features">Features</a><ul>
<li><a class="reference internal" href="#mappings">Mappings</a><ul>
<li><a class="reference internal" href="#types-of-mappings">Types of Mappings</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#testing">Testing</a><ul>
<li><a class="reference internal" href="#manual-tests">Manual tests</a></li>
<li><a class="reference internal" href="#automated-browser-tests">Automated Browser Tests</a></li>
<li><a class="reference internal" href="#python-unit-tests">Python Unit Tests</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="index.html"
                        title="previous chapter">Development</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="adding_new_object.html"
                        title="next chapter">Adding a new Object</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/development/overview.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="adding_new_object.html" title="Adding a new Object"
             >next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Development"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">GGRC 0.10.35-Raspberry (beb3baa) documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >Development</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2017, Google Inc..
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.6.
    </div>
  </body>
</html>